/*	Timed lamp control		970502 - Bundled with OPEN 3.0	980515 - Updated for 3.2	*/:INT wndw[4] {1 2 39 7}	values[60] { }	changed 0	:LONG lastTime 0		logMS 0	:CHAR defaults[40] "Dflts"	  defaultDir[80] "AutoProgs/TimedLamp Defaults/"	  fullSpec[80] ""	  	  myName[] "TimedLamp"	  :FCT main{	FLUSH CLEAR	myName LPSetName 	15 1 POSXY  myName PRINT		500 OPEN_BUFF IF RETURN THEN	:PTR buff		buff PickParams IF 		buff CLOSE		RETURN 	THEN	0 0 buff SETEMPTY	values "%(*)d" buff ENTER DROP			values READY 3 / :INT n	n NOT IF RETURN THEN	LPPrep	1 :INT i	&CustomTic LPTicFct	n NLOOP		values i PICK VAL :INT time		values i 1 + PICK VAL LPSetLamp		values i 2 + PICK VAL 1000 * 50 - &logMS =		&i 3 + DROP		n i 3 / LPSetProgress		time LPMeasure lpAbort BREAKIF	ENDLOOP	buff CLOSE		LPCleanup}FromKeyboard{	:PTR buff	0 :INT rtn			wndw 1 1 "Time(s) Lamp(æmol) LogInt(s)" 5 "Enter values, press <esc>" WINDOW	LOOP		buff STDEDIT		"\x1bSRE" 2 2 "Options" 6 "Press A Key"		"<esc> - abort\nS - store this, then run\nR - run\nE - resume editing\n"		MESSBOX UPC :INT key		_Esc key == IF 			1 &rtn = BREAK		THEN		'S' key == IF			buff StoreDefaults			BREAK		THEN		'R' key == BREAKIF	ENDLOOP	1 1 DISPWIDTH DISPHEIGHT 0 WINDOW CLEAR	rtn RETURN}FromFile{	:PTR buff		0 fullSpec "Select TimedLamp Specs" OPEN_FILE_ASK IF 1 RETURN THEN	:PTR f	buff RESET	f buff XFER	f CLOSE			defaults 0 SETREADY	defaultDir 0 SETREADY	defaultDir defaults fullSpec FPARSE		"YN" 2 2 defaults 6 "(Y/N)" "Edit these parameters?" MESSBOX 'Y' == IF		buff FromKeyboard RETURN		THEN		0 RETURN}/* Returns 0 for abort, 1 for ok */PickParams{	:PTR buff	buff RESET		CheckDir	"KF" 2 2 "Timed Lamp Program" "\nGet data...\n  K - from Keyboard\n  F - from File" 	MESSBOX :INT k	k 0x1b == IF 1 RETURN THEN	k 'K' == IF		buff FromKeyboard		RETURN	THEN	k 'F' == IF		buff FromFile 		RETURN			THEN}CheckDir{	theConfigDir fullSpec =	"/" fullSpec APP	defaultDir fullSpec APP		fullSpec FTYPE 0 == IF		fullSpec DIRMAKE DROP		THEN	defaults fullSpec APP}CustomTic{	GETMS DUP :LONG now	lastTime - logMS > IF 		LPLog		now &lastTime =	THEN	LogProgEverySec	}ReadDefaults{	:PTR dest		fullSpec FTYPE 1 == IF		"r" fullSpec OPEN_FILE NOT IF			:PTR file			file dest XFER			file CLOSE		THEN	THEN}		StoreDefaults{		:PTR source	0 0 source SETEMPTY	1 fullSpec "Store TimedLamp parameters" OPEN_FILE_ASK NOT IF		:PTR dest		source dest XFER		dest CLOSE	THEN}